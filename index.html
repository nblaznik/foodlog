<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Food Log</title>
  <style>
    body { font-family: sans-serif; margin: 40px; max-width: 500px; }
    textarea { width: 100%; height: 120px; padding: 8px; margin: 10px 0; }
    button { padding: 10px 15px; cursor: pointer; margin-bottom: 20px; }
    #status { margin-top: 10px; }
    .entry { padding: 10px; background: #f0f0f0; border-radius: 6px; margin-bottom: 8px; cursor: pointer; }
    .entry:hover { background: #e2e2e2; }
    h2 { margin-top: 40px; }
  </style>
</head>
<body>

<h1>Food Log</h1>
<p>Type anything about what you ate:</p>

<textarea id="entry" placeholder="Example: 'Lunch: chicken burgers with lettuce'"></textarea>

<button onclick="submitEntry()">Submit</button>

<p id="status"></p>

<h2>Recent Entries</h2>
<div id="history"></div>

<script>
const ENDPOINT = "https://script.google.com/macros/s/AKfycbxSukLiG3zgCUKz8vZLoTyYEGSuRFY404rFbVX0a8kDGKTjvaaEKZ7o62W8jn0X4g_h/exec";
const HISTORY_KEY = "foodlog_history";

// ---------------------------
// Load history on page load
// ---------------------------
document.addEventListener("DOMContentLoaded", loadHistory);

function loadHistory() {
  const historyDiv = document.getElementById("history");
  historyDiv.innerHTML = "";

  const saved = JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]");

  saved.forEach(item => {
    const div = document.createElement("div");
    div.className = "entry";
    div.innerText = item;
    div.onclick = () => {
      document.getElementById("entry").value = item;
      window.scrollTo({ top: 0, behavior: "smooth" });
    };
    historyDiv.appendChild(div);
  });
}

// ---------------------------
// Save entry to local history
// ---------------------------
function addToHistory(text) {
  let saved = JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]");

  // Add newest at top
  saved.unshift(text);

  // Keep only last 20
  saved = saved.slice(0, 20);

  localStorage.setItem(HISTORY_KEY, JSON.stringify(saved));
  loadHistory();
}

// ---------------------------
// Submit entry
// ---------------------------
async function submitEntry() {
  const text = document.getElementById("entry").value.trim();
  if (!text) return;

  addToHistory(text);
  document.getElementById("entry").value = "";
  document.getElementById("status").innerText = "Submitting...";

  const form = new FormData();
  form.append("entry", text);

  try {
    const response = await fetch(ENDPOINT, {
      method: "POST",
      body: form
    });

    const result = await response.text();
    document.getElementById("status").innerText = result;
  } catch (err) {
    document.getElementById("status").innerText = "error";
  }
}

</script>

</body>
</html>


